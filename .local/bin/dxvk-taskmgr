# 1. Specify the path to wine(64)
#    This can be either system-wide or a custom installation
WINE="/usr/share/steam/compatibilitytools.d/proton-ge-custom/files/bin/wine64"
#WINE="/usr/share/steam/compatibilitytools.d/proton-6.16-GE-1/files/bin/wine64"
#WINE="/usr/share/steam/compatibilitytools.d/proton-6.13-GE-1/files/bin/wine64"
#WINE="/archive/games/SteamLibrary/steamapps/common/Proton 6.3/dist/bin/wine64"

#RESOLUTION=1920x1080

#LANG=C

# get the right wine libs
winebindir=$(dirname $WINE)

if [ -z "$PATH" ]; then
  PATH="$winebindir"
else
  PATH="$winebindir:$PATH"
fi

if [ -z "$LD_LIBRARY_PATH" ]; then
  LD_LIBRARY_PATH="$winebindir/../lib64:$winebindir/../lib:$winebindir/../lib32"
else
  LD_LIBRARY_PATH="$winebindir/../lib64:$winebindir/../lib:$winebindir/../lib32:$LD_LIBRARY_PATH"
fi

export vblank_mode=0
export __GL_SYNC_TO_VBLANK=0

export ENABLE_VKBASALT=1
export VKBASALT_LOG_FILE="vkBasalt.log"

export WINEESYNC=1
export WINEFSYNC=0
export WINEDEBUG=fixme-all,err-all

# 1. Specify a WINEPREFIX
export WINEPREFIX="/home/archer/.local/share/wineprefixes/dxvk"

# 2. Create or update WINEPREFIX
#"$WINE" wineboot -u

# [3. Install DXVK (v1.9.0, for Wine 5.14+)]
#    Use the newest Winetricks script from GitHub

# 3. installing patched cmd.exe so fitgirl setups don't hang
if [ ! -f "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe.fit" ]; then
    curl --location --progress-bar \
        https://github.com/Francesco149/wine/releases/download/move-overwrite-fix-r2/cmd.exe.so \
        > "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe.fit" || exit
    mv "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe" "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe.orig"
    mv "$WINEPREFIX/drive_c/windows/system32/cmd.exe" "$WINEPREFIX/drive_c/windows/system32/cmd.exe.orig"
    cp "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe.fit" "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe"
    cp "$WINEPREFIX/drive_c/windows/syswow64/cmd.exe" "$WINEPREFIX/drive_c/windows/system32"
fi

export WINE
#sh winetricks usetakefocus=n

# 3. taskmgr launch
# requires staging or Proton, see TWEAKS.md
# "$WINE" control
gamemoderun "$WINE" taskmgr
